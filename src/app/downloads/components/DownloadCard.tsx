import { useState } from "react";
import Image from "next/image";
import Link from "next/link";
import { FontAwesomeIcon } from "@fortawesome/react-fontawesome";
import {
  faDownload,
  faCalendarAlt,
  faFileAlt,
  faCodeBranch,
  faTools,
  faCode,
  faLayerGroup,
  faFire,
  faClock,
  faGamepad,
} from "@fortawesome/free-solid-svg-icons";
import { DownloadItem } from "../data/downloads";

const PlatformIcon = ({ platform }: { platform: string }) => {
  switch (platform) {
    case "windows":
      return (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          className="h-4 w-4 text-foreground/60 fill-current"
        >
          <path d="M0 3.449L9.75 2.1v9.451H0m10.949-9.602L24 0v11.4H10.949M0 12.6h9.75v9.451L0 20.699M10.949 12.6H24V24l-12.9-1.801" />
        </svg>
      );
    case "macos":
      return (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          className="h-4 w-4 text-foreground/60 fill-current"
        >
          <path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z" />
        </svg>
      );
    case "linux":
      return (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          className="h-4 w-4 text-foreground/60 fill-current"
        >
          <path d="M12.504 0c-.155 0-.315.008-.48.021-4.226.333-3.105 4.807-3.17 6.298-.076 1.092-.3 1.953-1.05 3.02-.885 1.051-2.127 2.75-2.716 4.521-.278.832-.41 1.684-.287 2.489.117.781.43 1.516.968 2.177.088.11.176.218.26.335.241.334.484.667.724 1.009-.019.021-.026.05-.026.077 0 .068.055.124.123.124.06 0 .111-.04.122-.097.029-.149.057-.297.09-.444.004-.016.004-.033.012-.047.103-.182.217-.354.338-.516.124-.17.26-.334.386-.496.117-.153.242-.3.363-.441.121-.142.246-.283.375-.414.145-.148.294-.29.454-.417.148-.12.302-.235.464-.337.135-.086.273-.167.417-.233.127-.066.27-.118.4-.188.223-.12.444-.243.661-.377.174-.109.331-.235.513-.332.151-.81.312-.15.463-.226.144-.7.28-.155.414-.228.075-.41.156-.76.227-.122.063-.045.132-.079.193-.129.132-.097.26-.202.382-.32.112-.111.208-.238.302-.367.08-.11.167-.214.241-.331.058-.093.103-.199.15-.298.108-.226.189-.47.264-.714.102-.329.17-.67.208-1.017.039-.344.053-.686.047-1.038-.014-.687-.105-1.4-.15-2.086-.136-2.081.239-4.807 2.789-4.807.744 0 1.33.173 1.82.487.179.115.345.253.502.405 1.164 1.13 1.523 3.175 1.523 4.328 0 .873-.086 1.76-.159 2.634-.046.57-.101 1.148-.139 1.725-.031.479-.078.962-.052 1.44.006.112.014.224.027.335.028.24.082.482.146.714.06.214.137.422.208.632.054.162.114.335.123.51.004.071-.021.164-.021.164l.413-.012c.228-.063.442-.161.64-.295.184-.127.349-.293.489-.493.032-.046.058-.097.088-.145.096-.148.172-.332.223-.502.051-.17.097-.34.123-.516.027-.184.026-.371.023-.556-.003-.158-.012-.318-.018-.475 0-.062 0-.122-.004-.184-.016-.422-.044-.83-.087-1.243-.048-.484-.115-.955-.198-1.428-.14-.793-.383-1.683-.539-2.505-.114-.598-.213-1.199-.247-1.817-.024-.476-.027-.975.035-1.449.057-.43.166-.86.36-1.241.192-.38.449-.707.739-.982.208-.196.439-.364.684-.5.244-.135.494-.249.76-.33.288-.089.591-.149.895-.16.344-.012.691.025 1.021.125.332.098.647.259.918.49.27.231.484.518.63.839.145.32.218.674.218 1.032 0 .364-.083.738-.241 1.065-.164.332-.413.614-.708.825-.508.363-1.125.51-1.733.608-.469.074-.962.09-1.394.264-.21.085-.407.2-.594.33-.366.259-.703.577-.941.969-.239.392-.368.837-.368 1.294 0 .89.056 1.786.09 2.677.052 1.386.077 2.774.18 4.156.044.572.181 1.131.361 1.672.147.439.33.871.574 1.264.244.394.536.75.863 1.068.063.062.146.087.223.136.16.106.336.176.514.248.174.071.347.142.536.175.147.026.309.006.439.067.228.108.315.368.311.61-.004.241-.062.486-.146.714-.084.228-.193.443-.297.658-.193.404-.474.734-.79 1.009-.317.273-.667.5-1.038.661-.371.16-.766.252-1.162.252-1.076 0-1.875-.419-2.58-1.044-.328-.289-.62-.624-.894-.973-.274-.35-.515-.729-.755-1.112-.44-.7-.844-1.443-1.232-2.193-.309-.592-.597-1.196-.867-1.807-.134-.305-.333-.578-.265-.911.058-.282.331-.46.575-.559.244-.098.52-.121.692-.301.431-.449.546-1.143.378-1.738-.134-.472-.433-.877-.793-1.187-.362-.309-.779-.535-1.21-.692-.44-.157-.903-.244-1.364-.241-.456.003-.91.091-1.345.257-.138.053-.274.107-.401.18-.127.073-.259.136-.368.228-.108.092-.199.202-.284.314-.085.112-.169.226-.224.357-.129.306-.142.664-.122.998.008.131.029.258.056.386.026.128.056.258.097.382.041.124.09.249.142.369.051.12.114.232.171.349.057.117.112.235.173.349.061.115.13.227.191.341.072.132.142.266.219.394.077.129.161.25.24.376.079.125.16.249.243.37.084.122.173.242.254.366.082.123.159.247.248.367.089.12.184.235.276.355.046.06.098.116.138.183.04.066.074.137.11.205.038.068.079.134.111.207.033.073.06.15.086.226.047.14.086.285.113.434.027.15.043.301.043.454 0 .152-.083.285-.215.366-.131.081-.303.118-.473.118-.17 0-.343-.036-.476-.117-.131-.082-.217-.214-.217-.366 0-.095.012-.19.023-.283.012-.094.029-.188.039-.282.01-.095.014-.19.019-.286.005-.095.005-.19.005-.286 0-.048-.004-.095-.005-.143-.001-.048-.006-.095-.01-.143-.003-.048-.01-.096-.016-.144-.008-.047-.017-.095-.026-.142-.01-.047-.022-.092-.033-.139-.013-.046-.029-.093-.043-.139-.016-.046-.033-.092-.053-.137-.018-.045-.041-.09-.063-.135-.021-.044-.046-.088-.069-.131-.024-.044-.05-.087-.077-.13-.027-.043-.057-.086-.086-.128-.03-.042-.06-.084-.093-.125-.034-.041-.067-.082-.103-.122-.036-.04-.073-.08-.111-.12-.038-.04-.078-.079-.117-.118-.04-.039-.08-.079-.124-.117-.043-.038-.088-.075-.133-.113l-.142-.109c-.047-.036-.096-.071-.146-.107-.049-.035-.1-.069-.151-.103-.051-.034-.103-.066-.155-.099-.055-.033-.108-.068-.166-.098-.057-.03-.116-.056-.174-.086-.059-.029-.119-.057-.179-.085-.061-.028-.122-.055-.185-.081-.062-.026-.126-.05-.19-.074-.064-.024-.128-.049-.193-.071-.066-.023-.132-.045-.199-.067-.067-.02-.135-.043-.204-.06-.069-.018-.138-.033-.207-.05-.07-.016-.141-.03-.212-.044-.07-.014-.143-.026-.215-.038-.072-.013-.143-.025-.216-.035-.073-.01-.147-.019-.221-.026-.074-.008-.148-.015-.223-.021-.075-.006-.15-.009-.226-.013-.076-.003-.151-.006-.227-.007-.076-.001-.153 0-.229 0h-1.248c-.076 0-.153.001-.229 0-.076-.001-.151-.004-.227-.007-.076-.004-.151-.007-.226-.013-.075-.006-.149-.013-.223-.021-.074-.008-.148-.016-.221-.026-.073-.01-.144-.022-.216-.035-.072-.012-.145-.024-.215-.038-.07-.014-.141-.028-.212-.044-.069-.017-.138-.032-.207-.05-.069-.017-.137-.04-.204-.06-.067-.022-.133-.044-.199-.067-.065-.023-.129-.047-.193-.071-.064-.024-.128-.048-.19-.074-.063-.026-.124-.055-.185-.081-.06-.028-.12-.056-.179-.085-.058-.029-.117-.056-.174-.086-.058-.03-.111-.065-.166-.098-.052-.033-.104-.065-.155-.099-.051-.034-.102-.068-.151-.103-.05-.036-.099-.071-.146-.107-.048-.036-.095-.072-.142-.109-.045-.038-.09-.075-.133-.113-.044-.038-.084-.078-.124-.117-.04-.039-.079-.078-.117-.118-.038-.04-.075-.08-.111-.12-.036-.04-.069-.081-.103-.122-.033-.041-.063-.083-.093-.125-.029-.042-.059-.085-.086-.128-.027-.043-.053-.086-.077-.13-.023-.043-.048-.087-.069-.131-.022-.045-.045-.09-.063-.135-.02-.045-.037-.091-.053-.137-.014-.046-.03-.093-.043-.139-.011-.047-.023-.092-.033-.139-.009-.047-.018-.095-.026-.142-.006-.048-.013-.096-.016-.144-.004-.048-.009-.095-.01-.143-.001-.048-.005-.095-.005-.143v-.286c.001-.096.005-.191.01-.286.005-.095.014-.19.024-.283.01-.094.027-.188.039-.282.012-.093.029-.188.049-.281.02-.093.04-.185.071-.275.03-.09.068-.178.11-.265.042-.086.09-.172.142-.254.051-.083.111-.161.173-.236.064-.075.134-.148.207-.217.074-.07.152-.136.234-.198.082-.063.168-.123.256-.179.088-.056.179-.109.274-.156.095-.047.192-.09.291-.127.1-.038.201-.072.304-.098.102-.026.207-.047.312-.06.105-.014.212-.021.319-.021.107 0 .214.007.319.021.105.013.21.034.312.06.103.026.204.06.304.098.099.037.196.08.291.127.095.047.186.1.274.156.088.056.174.116.256.179.082.062.16.128.234.198.073.069.143.142.207.217.062.075.122.153.173.236.052.082.1.168.142.254.042.087.08.175.11.265.031.09.051.182.071.275.02.093.037.188.049.281.012.094.029.188.039.282.01.095.019.19.024.286.005.095.005.19.005.286 0 .19-.014.38-.041.566-.027.187-.067.37-.12.549-.028.092-.058.184-.092.274s-.073.177-.115.263c-.042.085-.087.17-.135.252-.048.082-.1.161-.156.238-.056.077-.116.15-.177.223-.062.072-.126.141-.194.208-.067.066-.139.13-.211.191-.073.061-.148.118-.226.173-.077.055-.157.107-.239.156-.082.049-.166.096-.252.139-.086.043-.173.083-.263.118-.09.036-.181.068-.273.098-.092.03-.185.055-.28.078-.094.023-.188.044-.283.059-.096.015-.192.025-.289.033-.096.008-.193.014-.29.014-.098 0-.195.002-.292-.006-.098-.008-.195-.015-.291-.03-.096-.015-.191-.037-.286-.059-.095-.023-.188-.049-.28-.078-.093-.03-.183-.062-.273-.098-.09-.035-.177-.075-.263-.118-.086-.043-.17-.09-.252-.139-.082-.049-.162-.101-.239-.156-.077-.055-.152-.112-.226-.173-.072-.061-.144-.125-.211-.191-.068-.067-.132-.136-.194-.208-.061-.073-.121-.146-.177-.223-.056-.077-.108-.156-.156-.238-.048-.082-.093-.167-.135-.252-.042-.086-.081-.173-.115-.263-.034-.09-.064-.182-.092-.274-.053-.179-.093-.362-.12-.549-.027-.186-.041-.376-.041-.566 0-.096 0-.191.005-.286.005-.096.014-.191.024-.286.01-.094.027-.188.039-.282.012-.093.029-.188.049-.281.02-.093.04-.185.071-.275.03-.09.068-.178.11-.265.042-.086.09-.172.142-.254.051-.083.111-.161.173-.236.064-.075.134-.148.207-.217.074-.07.152-.136.234-.198.082-.063.168-.123.256-.179.088-.056.179-.109.274-.156.095-.047.192-.09.291-.127.1-.038.201-.072.304-.098.102-.026.207-.047.312-.06.105-.014.212-.021.319-.021z" />
        </svg>
      );
    case "android":
      return (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          className="h-4 w-4 text-foreground/60 fill-current"
        >
          <path d="M17.523 15.3414c-.5511 0-.998-.4459-.998-.996s.4459-.996.998-.996.998.4459.998.996-.4469.996-.998.996m-11.046 0c-.5511 0-.998-.4459-.998-.996s.4459-.996.998-.996.998.4459.998.996-.4469.996-.998.996m11.4045-6.02l1.19-2.0613c.0698-.1206.0297-.2746-.0909-.3444-.1206-.0699-.2746-.0298-.3444.0908l-1.2044 2.0858c-.9307-.4273-1.9659-.6675-3.0671-.6675-1.1013 0-2.1364.2402-3.0671.6675L9.1593 7.0265c-.0698-.1206-.2238-.1607-.3444-.0908-.1206.0698-.1607.2238-.0909.3444l1.19 2.0613C7.5523 10.5692 6 12.7083 6 15.2155h12c0-2.5072-1.5523-4.6463-3.9155-5.8941" />
        </svg>
      );
    case "ios":
      return (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          className="h-4 w-4 text-foreground/60 fill-current"
        >
          <path d="M16.462 20.9c-.6.6-1.3 1.1-2.1 1.5-1.601.9-3.2 1.1-3.9 1.1-1.8 0-3.4-.5-4.7-1.3-1.4-.9-2.5-2.1-3.3-3.5-1.2-2.3-1.1-5.3.1-7.6.8-1.5 2-2.7 3.5-3.4 1.3-.5 2.8-.8 4-.8 1.1 0 2.2.2 3.3.5 1 .3 2 .8 2.8 1.4.2.1.3.3.3.7-.1 1.2-.6 2.3-1.4 3.1-.7.7-1.6 1.2-2.5 1.5-.9.3-1.9.4-2.9.3-.7-.1-1.4-.3-2.1-.5-.6-.3-1.1-.7-1.6-1.2-.3-.3-.5-.6-.6-1-.2-.5 0-1.1.4-1.4.4-.3.9-.4 1.4-.2.1 0 .2.1.3.1.2.1.3.3.4.5.1.2.2.4.3.5.3.5.8.9 1.3 1.1.6.2 1.2.3 1.9.3.3 0 .6 0 .9-.1.6-.1 1.1-.4 1.5-.9.4-.4.6-1 .6-1.6 0-.6-.1-1.8-1.2-2.7-.6-.5-1.3-.7-2-.8-.3 0-.5-.1-.8-.1-2.3-.1-4.6.4-6.5 1.6-1.3.8-2.1 2.2-2.4 3.6-.1.3-.1.5-.1.8-.1 1.6.5 3.1 1.6 4.3 1 1.1 2.2 1.7 3.5 1.9.5.1 1 .1 1.5.1 1.3-.1 2.6-.4 3.8-1.2.6-.4 1.2-.9 1.6-1.6.5-.9.7-2 .7-3 0-.4.3-.7.7-.8h.2c.3 0 .6.2.7.4.1.2.1.4.1.6 0 1.2-.3 2.4-.9 3.4-.6 1-1.4 1.9-2.3 2.6z" />
        </svg>
      );
    case "minecraft":
      return (
        <FontAwesomeIcon
          icon={faGamepad}
          className="h-4 w-4 text-foreground/60"
        />
      );
    default:
      return (
        <FontAwesomeIcon
          icon={faLayerGroup}
          className="h-4 w-4 text-foreground/60"
        />
      );
  }
};

interface DownloadCardProps {
  download: DownloadItem;
}

export default function DownloadCard({ download }: DownloadCardProps) {
  const [downloading, setDownloading] = useState(false);

  const handleDownload = () => {
    setDownloading(true);

    // Reset downloading state after 2 seconds
    setTimeout(() => {
      setDownloading(false);
    }, 2000);
  };

  const getCategoryIcon = () => {
    switch (download.category) {
      case "app":
        return (
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            className="h-3 w-3 fill-current"
          >
            <path d="M4 2h16a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2zm0 2v16h16V4H4zm8 3l4 4-4 4-4-4 4-4z" />
          </svg>
        );
      case "utility":
        return <FontAwesomeIcon icon={faTools} className="h-3 w-3" />;
      case "game":
        return <FontAwesomeIcon icon={faGamepad} className="h-3 w-3" />;
      case "library":
        return <FontAwesomeIcon icon={faCode} className="h-3 w-3" />;
      case "minecraft":
        return <FontAwesomeIcon icon={faGamepad} className="h-3 w-3" />;
      default:
        return <FontAwesomeIcon icon={faLayerGroup} className="h-3 w-3" />;
    }
  };

  const formatDate = (dateString: string) => {
    const date = new Date(dateString);
    return date.toLocaleDateString("en-US", {
      year: "numeric",
      month: "short",
      day: "numeric",
    });
  };

  const renderPlatformIcons = () => {
    return (
      <div className="flex space-x-2 mt-2">
        {download.platform.map((platform) => (
          <div
            key={platform}
            className="tooltip"
            data-tooltip={platform.charAt(0).toUpperCase() + platform.slice(1)}
          >
            <PlatformIcon platform={platform} />
          </div>
        ))}
      </div>
    );
  };

  // Rest of your component remains the same
  return (
    <div className="glass-card overflow-hidden transition-all duration-300 group hover:scale-[1.02] transform">
      {/* Your existing component JSX... */}
      <div className="relative h-44 w-full overflow-hidden">
        {/* ... */}
        <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent animate-shimmer" />

        <Image
          src={download.image}
          alt={download.title}
          fill
          sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"
          className="object-cover transition-transform duration-500 group-hover:scale-105"
          loading="lazy"
          placeholder="blur"
          blurDataURL="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNzAwIiBoZWlnaHQ9IjQ3NSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2ZXJzaW9uPSIxLjEiLz4="
        />

        {/* Badges */}
        <div className="absolute top-3 right-3 flex flex-col gap-2 items-end">
          {download.featured && (
            <div className="px-3 py-1 bg-accent/80 text-white text-xs font-medium rounded-full backdrop-blur-sm flex items-center gap-1.5">
              <FontAwesomeIcon icon={faFire} className="h-3 w-3" />
              <span>Featured</span>
            </div>
          )}

          {download.latest && (
            <div className="px-3 py-1 bg-green-500/80 text-white text-xs font-medium rounded-full backdrop-blur-sm flex items-center gap-1.5">
              <FontAwesomeIcon icon={faCodeBranch} className="h-3 w-3" />
              <span>Latest</span>
            </div>
          )}

          {download.soon && (
            <div className="px-3 py-1 bg-blue-500/80 text-white text-xs font-medium rounded-full backdrop-blur-sm flex items-center gap-1.5">
              <FontAwesomeIcon icon={faClock} className="h-3 w-3" />
              <span>Coming Soon</span>
            </div>
          )}
        </div>

        {/* Category badge */}
        <div className="absolute top-3 left-3 px-3 py-1 bg-background/50 backdrop-blur-sm border border-white/10 rounded-full text-xs flex items-center gap-1.5">
          {getCategoryIcon()}
          <span>
            {download.category.charAt(0).toUpperCase() +
              download.category.slice(1)}
          </span>
        </div>
      </div>

      <div className="p-5">
        <div className="flex justify-between items-start mb-2">
          <h3 className="text-lg font-semibold group-hover:text-accent transition-colors">
            {download.title}
          </h3>
          <span className="text-xs font-mono bg-background/50 px-2 py-0.5 rounded">
            v{download.version}
          </span>
        </div>

        <p className="text-foreground/70 text-sm mb-4 line-clamp-2">
          {download.description}
        </p>

        <div className="mb-4 text-xs text-foreground/60 space-y-1.5">
          <div className="flex items-center gap-2">
            <FontAwesomeIcon icon={faFileAlt} className="h-3.5 w-3.5" />
            <span>
              {download.fileName} ({download.fileSize})
            </span>
          </div>
          <div className="flex items-center gap-2">
            <FontAwesomeIcon icon={faCalendarAlt} className="h-3.5 w-3.5" />
            <span>Released: {formatDate(download.releaseDate)}</span>
          </div>
          <div className="flex items-center gap-2">{renderPlatformIcons()}</div>
        </div>

        {/* Download or Coming Soon button */}
        {download.soon ? (
          <button
            disabled
            className="flex items-center justify-center w-full gap-2 px-4 py-3 bg-blue-500/80 text-white rounded-lg text-sm font-medium opacity-80 cursor-not-allowed"
          >
            <FontAwesomeIcon icon={faClock} className="h-4 w-4" />
            <span>Coming Soon</span>
          </button>
        ) : (
          <Link
            href={download.downloadUrl}
            onClick={handleDownload}
            className="flex items-center justify-center w-full gap-2 px-4 py-3 bg-accent text-white rounded-lg text-sm font-medium transition-colors hover:bg-accent/90 disabled:opacity-50 disabled:cursor-wait"
            download={download.fileName}
            prefetch={false}
          >
            <FontAwesomeIcon
              icon={faDownload}
              className={`h-4 w-4 ${downloading ? "animate-bounce" : ""}`}
            />
            <span>{downloading ? "Downloading..." : "Download Now"}</span>
          </Link>
        )}
      </div>
    </div>
  );
}
